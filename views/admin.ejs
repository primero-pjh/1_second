<!DOCTYPE html>
<html>
	<head>
        <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width" />
		<title>탐지로봇 CTR</title>
        <link href="./stylesheets/style.css?ver=1.0" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet" 
            type="text/css">
        <link href="https://cdn.jsdelivr.net/npm/quasar@2.11.10/dist/quasar.prod.css" rel="stylesheet" type="text/css">
	</head>
	<body>
        <div id="app">
            <q-layout view="hHh LpR lff"
                container style="height: 700px;"
                class="shadow-2 rounded-borders"
                :class="$q.dark.isActive ? 'bg-grey-9' : 'bg-grey-3'" >
                <q-header reveal class="bg-primary">
                    <q-toolbar>
                        <q-toolbar-title>1_SECOND</q-toolbar-title>
                        <q-btn icon="person" label="account" flat>
                            <q-menu>
                                <q-list>
                                    <q-item clickable v-close-popup @click="logout">
                                        <q-item-section>로그아웃</q-item-section>
                                    </q-item>
                                </q-list>
                            </q-menu>
                        </q-btn>
                    </q-toolbar>
                </q-header>
    
                <q-drawer v-model="drawerLeft" class="bg-white text-black"
                    :width="200" :breakpoint="700" >
                    <q-list bordered separator >
                        <q-item clickable v-ripple @click="tab='connect_socket'">
                            <q-item-section class="text-bold">
                                <q-item-label>현재 접속한 소켓보기</q-item-label>
                            </q-item-section>
                        </q-item>
                        <q-item clickable v-ripple @click="tab='monitoring'">
                            <q-item-section class="text-bold">
                                <q-item-label>전체 모니터링</q-item-label>
                            </q-item-section>
                        </q-item>
                    </q-list>
                </q-drawer>
    
                <q-page-container>
                    <q-page>
                        <q-tab-panels v-model="tab" animated  class="shadow-2 rounded-borders">
                            <q-tab-panel name="connect_socket">
                                <div style="display: flex; flex-wrap: wrap;">
                                    <template v-for="socket in socket_list">
                                        <q-card style="min-width: 270px;" 
                                            class="q-mr-md q-mb-md">
                                            <q-img src="https://cdn.quasar.dev/img/parallax2.jpg">
                                                <div class="absolute-bottom">
                                                    <div class="text-h6">{{socket.id}}</div>
                                                    <div class="text-subtitle2">{{socket.name}}</div>
                                                </div>
                                            </q-img>
                                      
                                            <q-card-actions>
                                                <q-btn flat label="monitoring"></q-btn>
                                                <q-btn flat color="negative" disable
                                                    label="disconnect"></q-btn>
                                            </q-card-actions>
                                        </q-card>
                                    </template>
                                </div>
                            </q-tab-panel>
                            <q-tab-panel name="monitoring">
                                <q-tab-panel name="connect_socket">
                                    <div style="display: flex; flex-wrap: wrap;">
                                        <template v-for="socket in socket_list">
                                            <q-card style="min-width: 270px;" 
                                                class="q-mr-md q-mb-md">
                                                <q-img src="https://cdn.quasar.dev/img/parallax2.jpg"></q-img>
                                                <q-card-actions>
                                                    <div style="display: flex; justify-content: space-between;
                                                        align-items: center; width: 100%;">
                                                        <div class="text-h6">{{socket.name}}</div>
                                                        <div>
                                                            <q-btn flat color="negative" disable
                                                            label="disconnect"></q-btn>
                                                        </div>
                                                        
                                                    </div>
                                                </q-card-actions>
                                            </q-card>
                                        </template>
                                    </div>
                                </q-tab-panel>
                            </q-tab-panel>
                        </q-tab-panels>
                    </q-page>
                </q-page-container>
            </q-layout>
        </div>
	</body>
</html>
<script src="/javascripts/common.js"></script>
<script src="https://unpkg.com/vue@3"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.0/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quasar@2.11.10/dist/quasar.umd.prod.js"></script>
<script>
    const app = Vue.createApp({
        data() {
            return {
                socket: null,

                tab: 'connect_socket',
                drawerLeft: true,
                drawerRight: false,
                
                socket_list: [
                    {id: 1, name: 'first'},
                ],
            }
        },
        methods: {
            logout() {
                setCookie('token', '');
                window.location.href = '/admin/login';
            },
            /* load */
            loadSocketList() {
                let vm = this;
                vm.socket_list = [];
                vm.socket.emit('/socket/get/user', {
                }, (data, err) => {
                    let row = data.user_list;
                    vm.socket_list = row;
                    console.log("socket_list:", vm.socket_list);
                });
            },
        },
        mounted() {
            let vm = this;
            let token = getCookie('token');
            if(!token) { window.location.href = '/admin/login'; return; }
            const socket = io();
            vm.socket = socket;
            vm.loadSocketList();
            console.log("getCookie:", getCookie);
        },
    }).use(Quasar).mount('#app');
</script>